<!doctype html>
<html>

<head>
	<title>Bubble Chart</title>
	<script src="/Chart.min.js"></script>
	<script src="/utils.js"></script>
	<style type="text/css">
		canvas{
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
	</style>
</head>

<body>
	<div id="container" style="width: 75%;">
        <div id="message"></div> 
		<canvas id="canvas"></canvas>
	</div>
	<script>

        var get_relevant_search_from_address = function() {
            var output = window.location.href.replace(window.location.protocol, ""); 
            return output.replace(window.location.hostname, "");
        }
        var display_message = function(input) {
            document.getElementById('message').innerHTML = "<h1>" + input + "</h1>";
        }

		window.onload = function() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {

                    var resp = JSON.parse(this.response);
                    if(resp.message !== undefined) {
                        display_message(resp.message);
                    }
                    if(resp.chart) {
                        var ctx = document.getElementById('canvas').getContext('2d');
                        window.myChart = new Chart(ctx, resp.chart);
                    }
                }
            };
            display_message("Fetching " + get_relevant_search_from_address());
            xhttp.open("GET", window.location.href + ".json", true);
            xhttp.send();
		};

	</script>
</body>

</html>